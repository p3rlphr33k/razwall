#!/usr/bin/env python  
# encoding: utf-8
#
# +--------------------------------------------------------------------------+
# | Endian Firewall                                                          |
# +--------------------------------------------------------------------------+
# | Copyright (c) 2005-2011 Endian                                           |
# |         Endian GmbH/Srl                                                  |
# |         Bergweg 41 Via Monte                                             |
# |         39057 Eppan/Appiano                                              |
# |         ITALIEN/ITALIA                                                   |
# |         info@endian.com                                                  |
# |                                                                          |
# | endian-core is free software: you can redistribute it and/or modify      |
# | it under the terms of GNU General Public License (GPL) version 2.0       |
# | when released with the Community edition                                 |
# | or the GNU Lesser General Public License (LGPL) version 2.1              |
# | when released with the Enterprise edition.                               |
# |                                                                          |
# | endian-core is distributed in the hope that it will be useful,           |
# | but WITHOUT ANY WARRANTY; without even the implied warranty of           |
# | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the             |
# | GNU General Public License for more details or the                       |
# | GNU Lesser General Public License for more details.                      |
# |                                                                          |
# | You should have received a copy of the license along with endian-core.   |
# | If not, see <http://www.gnu.org/licenses/>.                              |
# +--------------------------------------------------------------------------+
#

from endian.core.i18n import _
from endian.data import DataSource
from endian.data.container.settings import SettingsFile
from endian.datatypes.ordered_dict import OrderedDict

__author__ = "Andrea Bonomi <a.bonomi@endian.com>"
__date__ = "2011-11-18"

__all__ = [
    'COUNTRIES',
    'COUNTRY_LONG_TO_SHORT',
    'country_from_timezone',
    'city_from_timezone'
]

# ISO 3166-1 alpha-2 
# http://www.iso.org/iso/country_codes/iso_3166_code_lists/country_names_and_code_elements.htm
# http://en.wikipedia.org/wiki/ISO_3166-1

COUNTRIES = OrderedDict([
    ("AF", _(u"Afghanistan")),
    ("AX", _(u"Aland Islands")),
    ("AL", _(u"Albania")),
    ("DZ", _(u"Algeria")),
    ("AS", _(u"American Samoa")),
    ("AD", _(u"Andorra")),
    ("AO", _(u"Angola")),
    ("AI", _(u"Anguilla")),
    ("AQ", _(u"Antarctica")),
    ("AG", _(u"Antigua and Barbuda")),
    ("AR", _(u"Argentina")),
    ("AM", _(u"Armenia")),
    ("AW", _(u"Aruba")),
    ("AU", _(u"Australia")),
    ("AT", _(u"Austria")),
    ("AZ", _(u"Azerbaijan")),
    ("BS", _(u"Bahamas")),
    ("BH", _(u"Bahrain")),
    ("BD", _(u"Bangladesh")),
    ("BB", _(u"Barbados")),
    ("BY", _(u"Belarus")),
    ("BE", _(u"Belgium")),
    ("BZ", _(u"Belize")),
    ("BJ", _(u"Benin")),
    ("BM", _(u"Bermuda")),
    ("BT", _(u"Bhutan")),
    ("BO", _(u"Bolivia, Plurinational State of")),
    ("BA", _(u"Bosnia and Herzegovina")),
    ("BW", _(u"Botswana")),
    ("BV", _(u"Bouvet Island")),
    ("BR", _(u"Brazil")),
    ("IO", _(u"British Indian Ocean Territory")),
    ("BN", _(u"Brunei Darussalam")),
    ("BG", _(u"Bulgaria")),
    ("BF", _(u"Burkina Faso")),
    ("BI", _(u"Burundi")),
    ("KH", _(u"Cambodia")),
    ("CM", _(u"Cameroon")),
    ("CA", _(u"Canada")),
    ("CV", _(u"Cape Verde")),
    ("KY", _(u"Cayman Islands")),
    ("CF", _(u"Central African Republic")),
    ("TD", _(u"Chad")),
    ("CL", _(u"Chile")),
    ("CN", _(u"China")),
    ("CX", _(u"Christmas Island")),
    ("CC", _(u"Cocos (Keeling) Islands")),
    ("CO", _(u"Colombia")),
    ("KM", _(u"Comoros")),
    ("CG", _(u"Congo")),
    ("CD", _(u"Congo, The Democratic Republic of the")),
    ("CK", _(u"Cook Islands")),
    ("CR", _(u"Costa Rica")),
    ("CI", _(u"Cote D'ivoire")),
    ("HR", _(u"Croatia")),
    ("CU", _(u"Cuba")),
    ("CY", _(u"Cyprus")),
    ("CZ", _(u"Czech Republic")),
    ("DK", _(u"Denmark")),
    ("DJ", _(u"Djibouti")),
    ("DM", _(u"Dominica")),
    ("DO", _(u"Dominican Republic")),
    ("EC", _(u"Ecuador")),
    ("EG", _(u"Egypt")),
    ("SV", _(u"El Salvador")),
    ("GQ", _(u"Equatorial Guinea")),
    ("ER", _(u"Eritrea")),
    ("EE", _(u"Estonia")),
    ("ET", _(u"Ethiopia")),
    ("FK", _(u"Falkland Islands (Malvinas)")),
    ("FO", _(u"Faroe Islands")),
    ("FJ", _(u"Fiji")),
    ("FI", _(u"Finland")),
    ("FR", _(u"France")),
    ("GF", _(u"French Guiana")),
    ("PF", _(u"French Polynesia")),
    ("TF", _(u"French Southern Territories")),
    ("GA", _(u"Gabon")),
    ("GM", _(u"Gambia")),
    ("GE", _(u"Georgia")),
    ("DE", _(u"Germany")),
    ("GH", _(u"Ghana")),
    ("GI", _(u"Gibraltar")),
    ("GR", _(u"Greece")),
    ("GL", _(u"Greenland")),
    ("GD", _(u"Grenada")),
    ("GP", _(u"Guadeloupe")),
    ("GU", _(u"Guam")),
    ("GT", _(u"Guatemala")),
    ("GG", _(u"Guernsey")),
    ("GN", _(u"Guinea")),
    ("GW", _(u"Guinea-bissau")),
    ("GY", _(u"Guyana")),
    ("HT", _(u"Haiti")),
    ("HM", _(u"Heard Island and McDonald Islands")),
    ("VA", _(u"Holy See (Vatican City State)")),
    ("HN", _(u"Honduras")),
    ("HK", _(u"Hong Kong")),
    ("HU", _(u"Hungary")),
    ("IS", _(u"Iceland")),
    ("IN", _(u"India")),
    ("ID", _(u"Indonesia")),
    ("IR", _(u"Iran, Islamic Republic of")),
    ("IQ", _(u"Iraq")),
    ("IE", _(u"Ireland")),
    ("IM", _(u"Isle of Man")),
    ("IL", _(u"Israel")),
    ("IT", _(u"Italy")),
    ("JM", _(u"Jamaica")),
    ("JP", _(u"Japan")),
    ("JE", _(u"Jersey")),
    ("JO", _(u"Jordan")),
    ("KZ", _(u"Kazakhstan")),
    ("KE", _(u"Kenya")),
    ("KI", _(u"Kiribati")),
    ("KP", _(u"Korea, Democratic People's Republic of")),
    ("KR", _(u"Korea, Republic of")),
    ("KW", _(u"Kuwait")),
    ("KG", _(u"Kyrgyzstan")),
    ("LA", _(u"Lao People's Democratic Republic")),
    ("LV", _(u"Latvia")),
    ("LB", _(u"Lebanon")),
    ("LS", _(u"Lesotho")),
    ("LR", _(u"Liberia")),
    ("LY", _(u"Libyan Arab Jamahiriya")),
    ("LI", _(u"Liechtenstein")),
    ("LT", _(u"Lithuania")),
    ("LU", _(u"Luxembourg")),
    ("MO", _(u"Macao")),
    ("MK", _(u"Macedonia, The Former Yugoslav Republic of")),
    ("MG", _(u"Madagascar")),
    ("MW", _(u"Malawi")),
    ("MY", _(u"Malaysia")),
    ("MV", _(u"Maldives")),
    ("ML", _(u"Mali")),
    ("MT", _(u"Malta")),
    ("MH", _(u"Marshall Islands")),
    ("MQ", _(u"Martinique")),
    ("MR", _(u"Mauritania")),
    ("MU", _(u"Mauritius")),
    ("YT", _(u"Mayotte")),
    ("MX", _(u"Mexico")),
    ("FM", _(u"Micronesia, Federated States of")),
    ("MD", _(u"Moldova, Republic of")),
    ("MC", _(u"Monaco")),
    ("MN", _(u"Mongolia")),
    ("ME", _(u"Montenegro")),
    ("MS", _(u"Montserrat")),
    ("MA", _(u"Morocco")),
    ("MZ", _(u"Mozambique")),
    ("MM", _(u"Myanmar")),
    ("NA", _(u"Namibia")),
    ("NR", _(u"Nauru")),
    ("NP", _(u"Nepal")),
    ("NL", _(u"Netherlands")),
    ("AN", _(u"Netherlands Antilles")),
    ("NC", _(u"New Caledonia")),
    ("NZ", _(u"New Zealand")),
    ("NI", _(u"Nicaragua")),
    ("NE", _(u"Niger")),
    ("NG", _(u"Nigeria")),
    ("NU", _(u"Niue")),
    ("NF", _(u"Norfolk Island")),
    ("MP", _(u"Northern Mariana Islands")),
    ("NO", _(u"Norway")),
    ("OM", _(u"Oman")),
    ("PK", _(u"Pakistan")),
    ("PW", _(u"Palau")),
    ("PS", _(u"Palestinian Territory, Occupied")),
    ("PA", _(u"Panama")),
    ("PG", _(u"Papua New Guinea")),
    ("PY", _(u"Paraguay")),
    ("PE", _(u"Peru")),
    ("PH", _(u"Philippines")),
    ("PN", _(u"Pitcairn")),
    ("PL", _(u"Poland")),
    ("PT", _(u"Portugal")),
    ("PR", _(u"Puerto Rico")),
    ("QA", _(u"Qatar")),
    ("RE", _(u"Reunion")),
    ("RO", _(u"Romania")),
    ("RU", _(u"Russian Federation")),
    ("RW", _(u"Rwanda")),
    ("BL", _(u"Saint Barthelemy")),
    ("SH", _(u"Saint Helena, Ascension and Tristan Da Cunha")),
    ("KN", _(u"Saint Kitts and Nevis")),
    ("LC", _(u"Saint Lucia")),
    ("MF", _(u"Saint Martin")),
    ("PM", _(u"Saint Pierre and Miquelon")),
    ("VC", _(u"Saint Vincent and the Grenadines")),
    ("WS", _(u"Samoa")),
    ("SM", _(u"San Marino")),
    ("ST", _(u"Sao Tome and Principe")),
    ("SA", _(u"Saudi Arabia")),
    ("SN", _(u"Senegal")),
    ("RS", _(u"Serbia")),
    ("SC", _(u"Seychelles")),
    ("SL", _(u"Sierra Leone")),
    ("SG", _(u"Singapore")),
    ("SK", _(u"Slovakia")),
    ("SI", _(u"Slovenia")),
    ("SB", _(u"Solomon Islands")),
    ("SO", _(u"Somalia")),
    ("ZA", _(u"South Africa")),
    ("GS", _(u"South Georgia and the South Sandwich Islands")),
    ("ES", _(u"Spain")),
    ("LK", _(u"Sri Lanka")),
    ("SD", _(u"Sudan")),
    ("SR", _(u"Suriname")),
    ("SJ", _(u"Svalbard and Jan Mayen")),
    ("SZ", _(u"Swaziland")),
    ("SE", _(u"Sweden")),
    ("CH", _(u"Switzerland")),
    ("SY", _(u"Syrian Arab Republic")),
    ("TW", _(u"Taiwan, Republic of China")),
    ("TJ", _(u"Tajikistan")),
    ("TZ", _(u"Tanzania, United Republic of")),
    ("TH", _(u"Thailand")),
    ("TL", _(u"Timor-leste")),
    ("TG", _(u"Togo")),
    ("TK", _(u"Tokelau")),
    ("TO", _(u"Tonga")),
    ("TT", _(u"Trinidad and Tobago")),
    ("TN", _(u"Tunisia")),
    ("TR", _(u"Turkey")),
    ("TM", _(u"Turkmenistan")),
    ("TC", _(u"Turks and Caicos Islands")),
    ("TV", _(u"Tuvalu")),
    ("UG", _(u"Uganda")),
    ("UA", _(u"Ukraine")),
    ("AE", _(u"United Arab Emirates")),
    ("GB", _(u"United Kingdom")),
    ("US", _(u"United States")),
    ("UM", _(u"United States Minor Outlying Islands")),
    ("UY", _(u"Uruguay")),
    ("UZ", _(u"Uzbekistan")),
    ("VU", _(u"Vanuatu")),
    ("VE", _(u"Venezuela, Bolivarian Republic of")),
    ("VN", _(u"Viet Nam")),
    ("VG", _(u"Virgin Islands, British")),
    ("VI", _(u"Virgin Islands, U.S.")),
    ("WF", _(u"Wallis and Futuna")),
    ("EH", _(u"Western Sahara")),
    ("YE", _(u"Yemen")),
    ("ZM", _(u"Zambia")),
    ("ZW", _(u"Zimbabwe")),
])

COUNTRY_LONG_TO_SHORT = {
    'Andorra' : 'AD',
    'United Arab Emirates' : 'AE',
    'Afghanistan' : 'AF',
    'Antigua and Barbuda' : 'AG',
    'Anguilla' : 'AI',
    'Albania' : 'AL',
    'Armenia' : 'AM',
    'Netherlands Antilles' : 'AN',
    'Angola' : 'AO',
    'Antarctica' : 'AQ',
    'Argentina' : 'AR',
    'American Samoa' : 'AS',
    'Austria' : 'AT',
    'Australia' : 'AU',
    'Aruba' : 'AW',
    'Azerbaijan' : 'AZ',
    'Bosnia and Herzegovina' : 'BA',
    'Barbados' : 'BB',
    'Bangladesh' : 'BD',
    'Belgium' : 'BE',
    'Burkina Faso' : 'BF',
    'Bulgaria' : 'BG',
    'Bahrain' : 'BH',
    'Burundi' : 'BI',
    'Benin' : 'BJ',
    'Bermuda' : 'BM',
    'Brunei Darussalam' : 'BN',
    'Bolivia' : 'BO',
    'Brazil' : 'BR',
    'Bahamas' : 'BS',
    'Bhutan' : 'BT',
    'Bouvet Island' : 'BV',
    'Botswana' : 'BW',
    'Belarus' : 'BY',
    'Belize' : 'BZ',
    'Canada' : 'CA',
    'Cocos (Keeling) Islands' : 'CC',
    'Democratic Republic of Congo' : 'CD',
    'Central African Republic' : 'CF',
    'Republic of the Congo' : 'CG',
    'Switzerland' : 'CH',
    'Cote d\'Ivoire' : 'CI',
    'Cook Islands' : 'CK',
    'Chile' : 'CL',
    'Cameroon' : 'CM',
    'China' : 'CN',
    'Colombia' : 'CO',
    'Costa Rica' : 'CR',
    'Serbia and Montenegro' : 'CS',
    'Cuba' : 'CU',
    'Cape Verde' : 'CV',
    'Christmas Island' : 'CX',
    'Cyprus' : 'CY',
    'Czech Republic' : 'CZ',
    'Germany' : 'DE',
    'Djibouti' : 'DJ',
    'Denmark' : 'DK',
    'Dominica' : 'DM',
    'Dominican Republic' : 'DO',
    'Algeria' : 'DZ',
    'Ecuador' : 'EC',
    'Estonia' : 'EE',
    'Egypt' : 'EG',
    'Western Sahara' : 'EH',
    'Eritrea' : 'ER',
    'Spain' : 'ES',
    'Ethiopia' : 'ET',
    'Finland' : 'FI',
    'Fiji' : 'FJ',
    'Falkland Islands' : 'FK',
    'Federated States of Micronesia' : 'FM',
    'Faroe Islands' : 'FO',
    'France' : 'FR',
    'Gabon' : 'GA',
    'United Kingdom' : 'GB',
    'Grenada' : 'GD',
    'Georgia' : 'GE',
    'French Guiana' : 'GF',
    'Guernsey' : 'GG',
    'Ghana' : 'GH',
    'Gibraltar' : 'GI',
    'Greenland' : 'GL',
    'Gambia' : 'GM',
    'Guinea' : 'GN',
    'Guadeloupe' : 'GP',
    'Equatorial Guinea' : 'GQ',
    'Greece' : 'GR',
    'South Georgia and the South Sandwich Islands' : 'GS',
    'Guatemala' : 'GT',
    'Guam' : 'GU',
    'Guinea-Bissau' : 'GW',
    'Guyana' : 'GY',
    'Hong Kong' : 'HK',
    'Heard and Mc Donald Islands' : 'HM',
    'Honduras' : 'HN',
    'Croatia' : 'HR',
    'Haiti' : 'HT',
    'Hungary' : 'HU',
    'Indonesia' : 'ID',
    'Ireland' : 'IE',
    'Israel' : 'IL',
    'Isle Of Man' : 'IM',
    'India' : 'IN',
    'British Indian Ocean Territory' : 'IO',
    'Iraq' : 'IQ',
    'Iran' : 'IR',
    'Iceland' : 'IS',
    'Italy' : 'IT',
    'Jersey' : 'JE',
    'Jamaica' : 'JM',
    'Jordan' : 'JO',
    'Japan' : 'JP',
    'Kenya' : 'KE',
    'Kyrgyzstan' : 'KG',
    'Cambodia' : 'KH',
    'Kiribati' : 'KI',
    'Comoros' : 'KM',
    'Federation of Saint Kitts and Nevis' : 'KN',
    'North Korea' : 'KP',
    'South Korea' : 'KR',
    'Kuwait' : 'KW',
    'Cayman Islands' : 'KY',
    'Kazakhstan' : 'KZ',
    'Laos' : 'LA',
    'Lebanon' : 'LB',
    'Saint Lucia' : 'LC',
    'Liechtenstein' : 'LI',
    'Sri Lanka' : 'LK',
    'Liberia' : 'LR',
    'Lesotho' : 'LS',
    'Lithuania' : 'LT',
    'Luxembourg' : 'LU',
    'Latvia' : 'LV',
    'Morocco' : 'MA',
    'Monaco' : 'MC',
    'Republic of Moldova' : 'MD',
    'Madagascar' : 'MG',
    'Marshall Islands' : 'MH',
    'Macedonia' : 'MK',
    'Mali' : 'ML',
    'Burma (Myanmar)' : 'MM',
    'Mongolia' : 'MN',
    'Macau' : 'MO',
    'Northern Mariana Islands' : 'MP',
    'Martinique' : 'MQ',
    'Mauritania' : 'MR',
    'Montserrat' : 'MS',
    'Malta' : 'MT',
    'Mauritius' : 'MU',
    'Maldives' : 'MV',
    'Malawi' : 'MW',
    'Mexico' : 'MX',
    'Malaysia' : 'MY',
    'Mozambique' : 'MZ',
    'Namibia' : 'NA',
    'New Caledonia' : 'NC',
    'Niger' : 'NE',
    'Norfolk Island' : 'NF',
    'Nigeria' : 'NG',
    'Nicaragua' : 'NI',
    'Netherlands' : 'NL',
    'Norway' : 'NO',
    'Nepal' : 'NP',
    'Nauru' : 'NR',
    'Niue' : 'NU',
    'New Zealand' : 'NZ',
    'Oman' : 'OM',
    'Panama' : 'PA',
    'Peru' : 'PE',
    'French Polynesia' : 'PF',
    'Papua New Guinea' : 'PG',
    'Philippines' : 'PH',
    'Pakistan' : 'PK',
    'Poland' : 'PL',
    'Saint Pierre and Miquelon' : 'PM',
    'Pitcairn Islands' : 'PN',
    'Puerto Rico' : 'PR',
    'Palestinian National Authority' : 'PS',
    'Portugal' : 'PT',
    'Palau' : 'PW',
    'Paraguay' : 'PY',
    'Qatar' : 'QA',
    'Reunion' : 'RE',
    'Romania' : 'RO',
    'Russia' : 'RU',
    'Rwanda' : 'RW',
    'Saudi Arabia' : 'SA',
    'Solomon Islands' : 'SB',
    'Seychelles' : 'SC',
    'Sudan' : 'SD',
    'Sweden' : 'SE',
    'Singapore' : 'SG',
    'Saint Helena' : 'SH',
    'Slovenia' : 'SI',
    'Svalbard and Jan Mayen Islands' : 'SJ',
    'Slovakia' : 'SK',
    'Sierra Leone' : 'SL',
    'San Marino' : 'SM',
    'Senegal' : 'SN',
    'Somalia' : 'SO',
    'Suriname' : 'SR',
    'Sao Tome and Principe' : 'ST',
    'El Salvador' : 'SV',
    'Syrian Arab Republic' : 'SY',
    'Swaziland' : 'SZ',
    'Turks and Caicos Islands' : 'TC',
    'Chad' : 'TD',
    'French Southern Territories' : 'TF',
    'Togo' : 'TG',
    'Thailand' : 'TH',
    'Tajikistan' : 'TJ',
    'Tokelau' : 'TK',
    'Timor-Leste' : 'TL',
    'Turkmenistan' : 'TM',
    'Tunisia' : 'TN',
    'Tonga' : 'TO',
    'Turkey' : 'TR',
    'Trinidad and Tobago' : 'TT',
    'Tuvalu' : 'TV',
    'Taiwan' : 'TW',
    'Tanzania' : 'TZ',
    'Ukraine' : 'UA',
    'Uganda' : 'UG',
    'United States Minor Outlying Islands' : 'UM',
    'United States' : 'US',
    'Uruguay' : 'UY',
    'Uzbekistan' : 'UZ',
    'Vatican City State' : 'VA',
    'Saint Vincent and the Grenadines' : 'VC',
    'Venezuela' : 'VE',
    'British Virgin Islands' : 'VG',
    'United States Virgin Islands' : 'VI',
    'Vietnam' : 'VN',
    'Vanuatu' : 'VU',
    'Wallis and Futuna Islands' : 'WF',
    'Samoa' : 'WS',
    'Yemen' : 'YE',
    'Mayotte' : 'YT',
    'South Africa' : 'ZA',
    'Zambia' : 'ZM',
    'Zimbabwe' : 'ZW'
}

def country_from_timezone():
    DS = DataSource()
    settings = DS.get('TIME', {}).get('SETTINGS', {})
    mapping = SettingsFile("/var/efw/time/timezone_country_mapping")
    timezone = settings.get("TIMEZONE", "")
    if timezone == "":
        return "IT"
    country = mapping.get(timezone, "")
    if country == "":
        return "IT"
    short = COUNTRY_LONG_TO_SHORT.get(country, "IT")
    return short

def city_from_timezone():
    DS = DataSource()
    settings = DS.get('TIME', {}).get('SETTINGS', {})
    timezone = settings.get("TIMEZONE", "/").split("/")
    if len(timezone) > 1:
        return timezone[1]
    return ""
