#!/usr/bin/python

__all__ = [
]

OLDBACKUPDIR="/home/httpd/html/backup/"
NEWBACKUPDIR="/var/backups/"

import os
import shutil
import glob

from endian.core.logger import *
from endian.core.runner import run
from endian.migration.migration import mainHandler

def main():
    if not os.path.exists(OLDBACKUPDIR):
        return
    if not os.path.isdir(NEWBACKUPDIR):
        try:
            os.mkdir(NEWBACKUPDIR)
        except IOError, e:
            error("Unable to create new backup directory %s: %s",
                    NEWBACKUPDIR, e)
            return
    info("Move backup files from %s to %s" %(
            OLDBACKUPDIR,
            NEWBACKUPDIR)
         )
    ok = True
    for i in glob.glob("%s/*" % OLDBACKUPDIR):
        try:
            shutil.move(i, NEWBACKUPDIR)
            info("Moved %s to %s"%(i, NEWBACKUPDIR))
        except Exception:
            ok = False
            error("Could not move file %s to %s." % (i, NEWBACKUPDIR),
                  exc_info=True)
            pass
    if ok:
        run("rm -Rf %s" % OLDBACKUPDIR )
        

if __name__ == '__main__':
    mainHandler(main)
